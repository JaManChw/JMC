<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace ="com.kh.jaManChw.store.dao.face.StoreDao">
	
	<select id="selectAllShoppingbasketList" parameterType="int" resultType="map">
		select S.*, I.ITEM_TITLE,I.item_price FROM shopping_basket S, item I where S.userno = ${userno} and S.itemno = I.itemno
	</select>
	
<!-- 	유저 번호 넣어야함	 -->
	<select id="updateSbUpdate"  resultType="map">
		UPDATE shopping_basket SET SB_ITEM_COUNT = ${sbItemCount} where basketno = ${basketno}
	</select>

	<select id="selectAllItem" parameterType="map" resultType="map">
		SELECT * FROM (
			SELECT rownum rnum, I.* FROM(
				SELECT I.*, IF.I_STORED_NAME
				FROM ITEM I
				JOIN ITEM_FILE IF
				ON I.ITEMNO = IF.ITEMNO
				WHERE 1=1
				<if test="type == 'goods' ">
					AND item_type = '칵테일 재료'
					OR item_type = '칵테일 도구'
					OR item_type = '칵테일 잔'
				</if>
				<if test='type.equals("materials")'>
					AND item_type = '위스키 물품'
					OR item_type = '와인 물품'
				</if>
				ORDER BY I.ITEMNO DESC
			)I
		)
		WHERE rnum BETWEEN #{paging.startno} AND #{paging.endno}
	</select>
	
	<select id="selectCurPage" resultType="int">
		SELECT count(*) cont FROM Item_File
	</select>
	
	<select id="selectCateSectrion" parameterType="map" resultType="map">
	SELECT * FROM (
			SELECT rownum rnum, I.* FROM(
				SELECT I.*, IF.I_STORED_NAME
				FROM ITEM I
				JOIN ITEM_FILE IF
				ON I.ITEMNO = IF.ITEMNO
				WHERE 1=1
				<if test="type == 'goodsglass' ">
					AND item_type = '칵테일 재료'
				</if>
				<if test="type == 'goodsshaker' ">
					AND item_type = '칵테일 도구'
				</if>	
				<if test="type == 'goodsoffset' ">
					AND item_type = '칵테일 잔'
				</if>
				<if test='type.equals("materials")'>
					AND item_type = '재료쪽 추가해서 넣어주기'
					OR item_type = '와인 물품'
				</if>
				ORDER BY I.ITEMNO DESC
			)I
		)
		WHERE rnum BETWEEN #{paging.startno} AND #{paging.endno}
	
	</select>
	
	<select id="selectSerchItem" parameterType="map" resultType="map">
		SELECT * FROM (
			SELECT rownum rnum, I.* FROM(
				SELECT I.*, IF.I_STORED_NAME
				FROM ITEM I
				JOIN ITEM_FILE IF
				ON I.ITEMNO = IF.ITEMNO
				WHERE 1=1
                AND (upper(item_title) LIKE '%' || upper(#{searchData}) || '%'
                or upper(item_content) LIKE '%' || upper(#{searchData}) || '%')
				ORDER BY I.ITEMNO DESC
			)I
		)
		WHERE rnum BETWEEN #{paging.startno} AND #{paging.endno}
	
	</select>
	
	<select id="selectItemOptionDetail" resultType="ItemOption" parameterType="int">
		SELECT *
		FROM item_option
		WHERE itemno = #{itemno}
	</select>
	
	<select id="selectItemFileDetail" resultType="ItemFile" parameterType="int">
		SELECT *
		FROM item_file
		WHERE itemno = #{itemno}
	</select>
	
	<select id="selectItemDetail" resultType="Item" parameterType="int">
		SELECT *
		FROM item
		WHERE itemno = #{itemno}
	</select>
	
	<insert id="insertItemQnA" parameterType="ItemQnAQ">
	INSERT INTO ITEM_QNA_Q(ITEM_QNANO, ITEMNO, USERNO, IQ_TITLE, IQ_CONTENT, IQ_OPTION, IQ_STATUS)
	VALUES(ITEM_QNA_Q_seq.NEXTVAL, #{itemno}, #{userno}, #{iqTitle}, #{iqContent}, '1', 'unprocessed')
	</insert>

</mapper>
